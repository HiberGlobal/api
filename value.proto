syntax = "proto3";

package hiber.value;

import "base.proto";

option java_multiple_files = true;
option java_package = "global.hiber.api.grpc.value";
option go_package = "hiber";

message Value {
    /* The type of value that is represented. */
    enum Type {
        OTHER = 0;

        /* This field contains numeric values, with an optional unit of measurement defined below. */
        NUMERIC = 1;

        /* This field contains text to be displayed. */
        TEXT = 2;

        /* This field switches between several predefined values. Typically used for status fields. */
        ENUM = 3;
    }

    Type type = 1;
    oneof value {
        Numeric numeric = 2;
        string text = 3;
        Enum enum = 4;
    }

    /* If the value is numeric, this specifies the unit, value, etc. */
    message Numeric {
        /* The type of numeric value that is represented.
         * Supported types will automatically convert to the preferred unit (based on the user settings).
         */
        enum Type {
            TYPE_UNKNOWN = 0;
            PERCENTAGE = 1;
            TEMPERATURE = 2;
            DISTANCE = 3;
            PRESSURE = 4;
            VOLTAGE = 5;
            SPEED = 6;
            VOLUME = 7;
            DURATION = 8;
            FUEL_EFFICIENCY = 9;
            MASS = 10;
            BATTERY_LEVEL = 11;
            FLOW = 12;
            ROTATION_SPEED = 13;
            RATE = 14;
        }

        /* Special case for battery level, since it can be provided in many units.
         * Not included in the UnitPreferences, since it cannot be converted.
         */
        message BatteryLevel {
            // other units will be added here later, like voltage
            enum Unit {
                /* Battery level as a percentage (technically not a unit). */
                PERCENT = 0;
            }

            double value = 1;
            Unit unit = 2;

            /* Textual representation including unit symbol, rounded based on the user preferences and field config. */
            string textual = 3;

            /* The original unit, iff this value was converted from another unit because of user preferences. */
            Unit converted_from = 4;
        }

        /* The value for rotation speed. The only value is revolutions per minute (RPM), therefore it is not included in
         * unit preferences.
         */
        message RotationSpeed {
            enum Unit {
                REVOLUTIONS_PER_MINUTE = 0;
            }

            double value = 1;
            Unit unit = 2;

            /* Textual representation including unit symbol, rounded based on the user preferences and field config. */
            string textual = 3;

            /* The original unit, iff this value was converted from another unit because of user preferences. */
            Unit converted_from = 4;
        }

        /* The value is a distance value, converted to your preferred distance unit. */
        message Distance {
            enum Unit {
                METER = 0;
                MILLIMETER = 1;
                CENTIMETER = 2;
                KILOMETER = 3;
                YARD = 5;
                MILE = 4;
                FOOT = 6;
                INCH = 7;

                /* This is a special case unit and may not be auto-converted to your UnitPreference. */
                NAUTICAL_MILE = 8;
            }

            double value = 1;
            Unit unit = 2;

            /* Textual representation including unit symbol, rounded based on the user preferences and field config. */
            string textual = 3;

            /* The original unit, iff this value was converted from another unit because of user preferences. */
            Unit converted_from = 4;
        }

        /* The value is a distance value, converted to your preferred distance unit. */
        message FuelEfficiency {
            enum Unit {
                LITER_PER_100_KILOMETER = 0;
                KILOMETER_PER_LITER = 1;
                KILOMETER_PER_GALLON = 2;
                KILOMETER_PER_IMPERIAL_GALLON = 3;
                MILE_PER_GALLON = 4;
                MILE_PER_IMPERIAL_GALLON = 5;
                MILE_PER_LITER = 6;
            }

            double value = 1;
            Unit unit = 2;

            /* Textual representation including unit symbol, rounded based on the user preferences and field config. */
            string textual = 3;

            /* The original unit, iff this value was converted from another unit because of user preferences. */
            Unit converted_from = 4;
        }

        /* The value is a percentage. */
        message Percentage {
            enum Unit {
                /* Technically not a unit, but for consistency, we've added it here. */
                PERCENT = 0;
            }

            float value = 1;
            Unit unit = 3;

            /* Textual representation with % symbol, rounded based on the user preferences and field config. */
            string textual = 2;
        }

        /* The value is a pressure value, converted to your preferred pressure unit. */
        message Pressure {
            enum Unit {
                BAR = 0;
                PSI = 1;
                K_PA = 2;
            }

            double value = 1;
            Unit unit = 2;

            /* Textual representation including unit symbol, rounded based on the user preferences and field config. */
            string textual = 3;

            /* The original unit, iff this value was converted from another unit because of user preferences. */
            Unit converted_from = 4;
        }

        /* The value is a speed value, converted to your preferred speed unit. */
        message Speed {
            enum Unit {
                KILOMETERS_PER_HOUR = 0;
                /* This is a special case unit and may not be auto-converted to your UnitPreference. */
                KNOTS = 1;
                METERS_PER_SECOND = 2;
                MILES_PER_HOUR = 3;
            }

            double value = 1;
            Unit unit = 2;

            /* Textual representation including unit symbol, rounded based on the user preferences and field config. */
            string textual = 3;

            /* The original unit, iff this value was converted from another unit because of user preferences. */
            Unit converted_from = 4;
        }

        /* The value is a temperature, converted to your preferred temperature unit. */
        message Temperature {
            enum Unit {
                KELVIN = 0;
                DEGREES_CELSIUS = 1;
                DEGREES_FAHRENHEIT = 2;
            }

            double value = 1;
            Unit unit = 2;

            /* Textual representation including unit symbol, rounded based on the user preferences and field config. */
            string textual = 3;

            /* The original unit, iff this value was converted from another unit because of user preferences. */
            Unit converted_from = 4;
        }

        /* The value is a voltage, converted to your preferred voltage unit. */
        message Voltage {
            enum Unit {
                MILLIVOLT = 0;
            }

            double value = 1;
            Unit unit = 2;

            /* Textual representation including unit symbol, rounded based on the user preferences and field config. */
            string textual = 3;

            /* The original unit, iff this value was converted from another unit because of user preferences. */
            Unit converted_from = 4;
        }

        /* The value is a volume value, converted to your preferred volume unit. */
        message Volume {
            enum Unit {
                LITER = 0;
                GALLON_US = 1;
                GALLON_IMPERIAL = 2;
                CUBIC_METER = 3;
                CUBIC_FEET = 4;
            }

            double value = 1;
            Unit unit = 2;

            /* Textual representation including unit symbol, rounded based on the user preferences and field config. */
            string textual = 3;

            /* The original unit, iff this value was converted from another unit because of user preferences. */
            Unit converted_from = 4;
        }

        /* The value is a volume value, converted to your preferred volume unit. */
        message Mass {
            enum Unit {
                KILOGRAMS = 0;
                POUNDS = 1;
            }

            double value = 1;
            Unit unit = 2;

            /* Textual representation including unit symbol, rounded based on the user preferences and field config. */
            string textual = 3;

            /* The original unit, iff this value was converted from another unit because of user preferences. */
            Unit converted_from = 4;
        }

        message Flow {
            enum Unit {
                CUBIC_METER_PER_HOUR = 0;
                BARRELS_PER_DAY = 1;
            }

            double value = 1;
            Unit unit = 2;

            /* Textual representation including unit symbol, rounded based on the user preferences and field config. */
            string textual = 3;
            /* The original unit, iff this value was converted from another unit because of user preferences. */
            Unit converted_from = 4;
        }

        message Rate {
            enum Unit {
                /* The amount of items counted in a 24 hour window. */
                ITEMS_PER_24_HOURS = 0;
            }

            uint32 value = 1;
            Unit unit = 2;

            /* Textual representation including unit symbol, rounded based on the user preferences and field config. */
            string textual = 3;
            /* The original unit, iff this value was converted from another unit because of user preferences. */
            Unit converted_from = 4;
        }

        /* The duration enum is not wrapped in Duration, since duration is always returned as a normalize Duration.
         * This unit is still used for fields, however.
         */
        enum DurationUnit {
            MILLISECONDS = 0;
            SECONDS = 1;
            MINUTES = 2;
            HOURS = 3;
            DAYS = 4;
            WEEKS = 5;
        }

        Type type = 1;
        oneof value {
            BatteryLevel battery_level = 11;
            Distance distance = 3;
            Duration duration = 4;
            FuelEfficiency fuel_efficiency = 14;
            Percentage percentage = 5;
            Pressure pressure = 6;
            Speed speed = 7;
            Temperature temperature = 8;
            Voltage voltage = 9;
            Volume volume = 10;
            Mass mass = 12;
            Flow flow = 13;
            RotationSpeed rotation_speed = 16;
            Rate rate = 17;

            double unknown = 15;
        }
    }

    /* If this value is an enum, this specifies the value, display name and color for this enum value. */
    message Enum {
        /* The enum value. This might be a cryptic value, see the display_name and description for more information. */
        string value = 1;

        /* User-facing name for this value. */
        string display_name = 2;

        /* More details for this enum value. */
        string description = 3;

        /* (Optional) color for this enum value. */
        string color = 4;

        /* Priority of the value, typically used for ordering. */
        int32 priority = 5;
    }
}

/* Get the values for the selected field.
 *
 * There are a few limitations here:
 * - text fields can only use the LAST aggregation.
 * - enum fields support a subset of aggregations:
 *   - DEFAULT and LAST return the last value.
 *   - MINIMUM and MAXIMUM return the lowest or highest value (respectively) based on the enum value order.
 *   - AVERAGE and SUM are not supported.
 *
 * - enum duration
 *
 * An enum example:
 * Field "status" with this timeline: 00:00 OK, 00:10 FAILED, 00:20 OK, 00:25 FAILED, 00:40 OK
 * - aggregation DEFAULT or LAST: OK, since it's OK at the end of the time range.
 * - aggregation SUM: OK: 35m, FAILED: 25m
 */
enum ValueAggregation {
    DEFAULT = 0;

    /* Return the average value.
     * Not supported for textual and enum fields. When used with these fields, LAST is used instead.
     */
    AVERAGE = 1;

    /* Return the sum all values.
     * Not supported for textual and enum fields. When used with these fields, LAST is used instead.
     */
    SUM = 2;

    /* Just take the last value. */
    LAST = 3;

    /* Return the lowest value.
     * For enum fields, the order of values is used to determine the MINIMUM.
     * Not supported for textual fields. When used with these fields, LAST is used instead.
     */
    MINIMUM = 4;

    /* Return the highest value.
     * For enum fields, the order of values is used to determine the MAXIMUM.
     * Not supported for textual fields. When used with these fields, LAST is used instead.
     */
    MAXIMUM = 5;
}

/* Transform the values into a derived value. */
enum ValueTransformation {
    /* Instead of returning the value, return the amount of time a value was active.
     * Aggregation (if applicable) is applied afterwards on the duration value.
     */
    DURATION = 0;

    /* Instead of returning the value, return the difference between the value and the previous value.
     * Aggregation (if applicable) is applied before the delta is calculated.
     */
    DELTA = 1;
}
